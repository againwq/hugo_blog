---
author: "xqc"
title: "5G物理层过程"
date: 2024-04-17
series: ["compete"]
tags: ["大唐杯"]
ShowToc: true
TocOpen: true
---

## 5G物理层过程概述

物理层,即**PHY层**

### 物理层主要功能

1. 物理信道调制与解调
2. 频率与时间同步
3. 无线特征测量, 并向高层提供指示
4. MIMI天线处理
5. 物理射频处理

### 5G的NR帧结构

见**物理信道与信号**那一篇

### 5G 帧结构配置

+ **半静态配置**: **RRC配置**, 小区专用与UE专用两种方式
+ **动态配置**: **DCI(上行信道信息)配置**, 使用**SFI(时隙格式指示)**和**DCI调度两种方式**
+ 支持不同周期的配置
+ 支持双周期配置

具体见**物理信道与信号**那一篇

#### 物理层资源

![5G物理层资源](http://120.55.68.94/picture/5G物理层过程/5G物理层资源.PNG)

基本时间为**T<sub>c</sub> = 1 / (f * N)**, 4G是其**64倍**

##### 天线端口

![天线端口](http://120.55.68.94/picture/5G物理层过程/天线端口.PNG)

## 小区搜索

![小区搜索流程](http://120.55.68.94/picture/5G物理层过程/小区搜索流程.PNG)

+ **PCI = PSS + 3 * SSS**
+ 获得PCI可以得到**DMRS(解调参考信号)**以解调**PBCH信道**
+ **MIB消息**在**PBCH**上传输
+ **SIB1**消息在**PDCCH和PDSCH**上传输

### PLMN

**PLMN**分为**手动和自动模式**

### 频点选择

根据**栅格计算频点**

![频点选择](http://120.55.68.94/picture/5G物理层过程/频点选择.PNG)

### 小区搜索

#### PSS

+ **3条**长度为**127**的伪随机序列,采用**BPSK M**序列
+ 中间连续127个子载波, 两侧加8和9个保护间隔, 共**144个子载波**
+ PSS提供的计算PCI的N取值**0,1,2**

#### SSS

+ **336条**长度为**127**的伪随机序列,采用**BPSK M**序列
+ 中间连续127个子载波, 两侧加8和9个保护间隔, 共**144个子载波**
+ SSS提供的计算PCI的N取值**0 ~ 355**
  
#### PCI

+ PCI是物理小区ID, NR中,总共有**1008**个物理层小区ID
+ UE获取PCI后, 解调**DMRS for PBCH**, 获取SSB的位置索引

#### PSS和SSS资源位置

+ PSS、SSS和PBCH构成**SSB**
+ PSS、SSS、和PBCH**公用天线端口号P=4000**
+ SSB的子载波间隔**不能取&mu;=2,即60KHz**, &mu;=0,1为**typeA**, &mu;=3,4为**typeB**
+ SSB最长符号数可取**4,8,64**(**一个半帧内5ms, typeA**)
+ SSB周期: **5ms, 10ms, 20ms, 40ms, 80ms, 160ms**
+ 在初始小区搜索过程中,终端假定SSB周期为**20ms**
+ SSB详细见**物理信道与信号**


## 小区选择和重选

### 小区选择

#### 概述

+ UE在**RRC_IDLE和RRC_INACTIVATE**状态下进行
+ UE需要先完成**PLMN**的选择(小区搜索的部分), 在已选择的PLMN上选择合适的小区,获取合适的服务,监听控制信道,这个过程即小区选择过程
+ 根据小区重选准则, UE寻找其他更合适的小区进行小区重选,重选后的小区若不属于UE**已注册的TAC**列表内,UE需要发起位置登记
+ **小区禁止参数**在**MIB**中给出(cellBarred)
+ **小区预留参数**在**SIB1**中给出(cellReservedForOperatorUse)

![小区预留](http://120.55.68.94/picture/5G物理层过程/小区预留.PNG)

#### 小区选择策略

![小区选择策略](http://120.55.68.94/picture/5G物理层过程/小区选择策略.png)

+ UE先通过**小区测量,测量波束强度**再进行小区选择
+ 多波束情况下,UE根据检测到的**SSB最大波束**测量值与门限对比,若大于门限值,则选择这个**最强波束的小区**,否则对检测到的所有最强波束进行**线性平均**,作为小区的最终测量值
+ 相比于4G, 5G小区选择多了一个**Qoffset<sub>temp</sub>参数**

### 小区重选

#### 小区重选过程

+ 小区重选是根据**频点优先级(SSB的频点优先级,0 ~ 7)**进行重选的
+ 频点优先级获取方式: **系统消息和专用信令(如RRC Release消息)**
+ **重选流程**: **重选参数获取 -> 邻区启测判决 -> 小区重选判决**

#### 重选参数获取

![小区重选参数获取](http://120.55.68.94/picture/5G物理层过程/小区重选参数获取.PNG)

注: 只有**SIB**系统消息,没有**MIB**系统消息

#### 邻区启测判决

![邻区启测判决](http://120.55.68.94/picture/5G物理层过程/邻区启测判决.PNG)

#### 重选判决

+ 都需要满足UE在**服务小区**驻留超过**1s**


## 随机接入(RA)

+ 小区选择完成的是UE与基站**下行同步**, 随机接入要完成**上行同步**
+ 包括**竞争随机接入**和**非竞争随机接入**

### 随机接入的场景

![随机接入场景](http://120.55.68.94/picture/5G物理层过程/随机接入场景.PNG)

### 前导码(Preamble)

+ 前导码分为**长序列和短序列**, 具体见物理信道与信号的**PRACH(随机接入信道)**

### 4G与5G RA的区别

![4G5G在RA的区别](http://120.55.68.94/picture/5G物理层过程/4G5G在RA的区别.PNG)

+ 5G中的RA, UE总是选择最好的**beam, 即波束**来执行RA过程
+ UE在**SIB1消息**读取到**RACH信道的配置信息**

### 基于竞争的随机接入

![基于竞争的随机接入](http://120.55.68.94/picture/5G物理层过程/基于竞争的随机接入过程.PNG)

+ UE收到的msg2的**资源不可用**, 需要等待一个间隔重新发送msg1,这个间隔是**BI**
+ msg2过程是在**PDSCH**进行的,在这之前需要在**PDCCH信道中**找到调度PDSCH的资源, 寻找的依据是**RAPID**, 具体来说是RAPID中的**RA-RNTI**

### 基于非竞争的RA

![基于非竞争的RA](http://120.55.68.94/picture/5G物理层过程/基于非竞争的RA.PNG)

+ 基于竞争的RA是**随机选择**Preamble码, 而非竞争的RA是由**上层指定**Preamble码

### 随机接入的具体过程

+ gNB向UE下发**SIB1**：这是启动随机接入过程的第一步，gNB通过**下行控制信息(DCI)格式1_0**，携带**SI-RNTI**(广播网络临时标识),通过**PDCCH或PDSCH**通道发送给UE，指示其进行随机接入
+ UE获取PRACH资源配置：UE通过监听PDCCH或PDSCH通道，获取gNB分配的随机接入资源，这包括PRACH的时频位置和长度等信息
+ UE传输PRACH Preamble(msg1)：UE在PRACH信道上发送**带有PA-RNTI的PRACH Preamble**，该Preamble是UE的随机接入尝试的一部分
+ gNB发送**DCI格式1_0**：gNB在检测到UE发送的PRACH Preamble后，通过DCI格式1_0，携带**RA-RNTI**，并在**PDCCH或PDSCH**上发送，以回应UE的随机接入尝试
+ gNB通过PDCCH或PDSCH发送**MSG2**：此信令中包含了TC-RNTI、跟踪区域（TA）和上行许可（UL-Grant），是gNB对UE随机接入尝试的响应
+ UE通过PUSCH信道发送**MSG3**：UE在接收到gNB的响应后，通过PUSCH信道发送包含UEID的消息，以完成随机接入过程的这一阶段
+ gNB发送DCI格式1_0：gNB**再次通过DCI格式1_0**，携带**TC-RNTI**，分配资源用于UE的链接响应
+ gNB通过PDCCH或PDSCH发送**MSG4**：此信令中包含了UEID，是**gNB对UE链接响应的确认**
+ UE通过PDCCH或PDSCH发送MSG5：UE在接收到gNB的确认后，通过PDCCH或PDSCH信道发送最后一个消息，以完成随机接入过程


## 功率控制

### 功控作用

1. 抑制小区间干扰
2. 省电, 减少发射功率
3. 在小区内, 主要用于补偿路损和阴影

功控分为**上行功率控制**和**下行功率分配**

### 上行功率控制

+ PRACH功率控制: UE在**UL BWP(上行BWP**)确定PRACH的功率
+ PUSCH功率控制(专门传输Msg3)
+ PUSCH功率控制
+ PUCCH功率控制
+ SRS功率控制

## 波束管理

UE在**RRC_ACTIVE和RRC_IDLE**都需要进行波束管理
+ RRC_ACTIVE: 下行使用**CSI-RS和SSB**, 上行用**SRS**
+ RRC_IDLE: 下行用**SSB**, 上行用**PRACH**
+ 波束管理包括**波束上报, 波束指示,波束恢复**
### 空闲态

#### 下行

+ 基站侧采用**窄波束+轮询**发送**SSB和系统消息**
+ UE侧采用**窄波束+轮询**接受的方式, 选择合适的波束

#### 上行

+ 就是进行**随机接入**(采用PRACH信道)

### 连接态

#### 下行

+ 基站侧进行**分级扫描**, **波束由宽到窄**
+ UE采用**先宽波束+轮询**, 再根据接收到的TCI状态,**固定接受波角度(不轮询了)使用窄波束**
+ 第三阶段, 基站采用**波束方向固定+窄波束**, UE采用**窄波束+轮询**

#### 上行

+ UE完成接入后, 上行通过**SRS**进行波束训练(不支持波束细化训练)
+ 基站通过参数直接指定上行所使用的波束**SRS Resource ID**

### 波束恢复

UE先进行**波束失败检测**, 然后UE发送**BFRQ**(波束失败恢复请求), 基站进行**新的候选波束的选择**,并响应**BFRP**(波束恢复响应)

### 波束恢复请求方式

+ 通过**非竞争**的PRACH
+ 通过PUCCH
+ FFS: **基于竞争**的PRACH

## HARQ过程(混合自动重传请求)

+ HARQ是**FEC和ARQ**的一种混合技术机制
+ HARQ是**MAC**层的快速传输机制
+ NR中,上下行均采用**异步HARQ**
+ 不支持**跨小区**HARQ重传

### HARQ实体和HARQ进程

+ 每个小区有**一个**HARQ实体,上下行HARQ实体相互**独立**
+ HARQ进程数量是**UE级配置参数**,上行**固定16个**,下行可配置,最多**16个**
+ 仅支持**顺序HARQ调度**
+ **DCI format1_0和1_1**会携带部分HARQ信息
+ DCI中的**NDI**可以用来判断接受的**TB块(传输块)**是新传块还是重传块

### CBG

+ TB: 传输块
+ CB: 码块
+ CBG: 码块组

**一个TB(包含CRC)超过CB最大长度限定后,TB会被切分成多个CB发送,把一个TB切分成的CB进行分组(而不是整个一起传),每个组叫做CBG**

+ 一个TB最大的CBG个数: **2,4,6,8**(需要RRC高层配置)
